# 文件夹搜索（支持符号链接）

一个 VS Code 扩展，提供快速的文件夹和文件搜索功能，**完全支持符号链接**。与其他文件夹搜索扩展不同，本扩展能够正确跟踪符号链接并索引其目标目录，非常适合具有复杂目录结构的项目。

## 功能特性

- 🔍 **快速文件夹搜索**：快速搜索工作区中的所有文件夹
- 🔗 **符号链接支持**：跟踪符号链接并索引其内容
- 🚀 **智能缓存**：缓存结果以实现即时的后续搜索
- 📊 **智能排序**：按相关性排序结果（精确匹配、前缀匹配等）
- ⚙️ **高度可配置**：自定义深度、排除项等
- 🛡️ **健壮的错误处理**：优雅地处理损坏的符号链接、权限错误
- 📁 **多文件夹工作区**：与多根工作区无缝协作

## 使用方法

### 搜索文件夹

1. 打开命令面板（`Cmd+Shift+P` 或 `Ctrl+Shift+P`）
2. 输入 "Search Folders" 并选择 **"Folder Search: Search Folders (with Symlink Support)"**
3. 开始输入以过滤结果
4. 选择一个文件夹以在文件资源管理器中显示它，或选择文件以打开它

### 刷新缓存

如果文件夹结构发生重大变化，可以手动刷新缓存：

1. 打开命令面板
2. 输入 "Refresh" 并选择 **"Folder Search: Refresh Folder Index Cache"**

## 配置选项

通过 VS Code 设置配置扩展：

```json
{
  // 是否跟踪符号链接（默认：true）
  "fold-search.followSymlinks": true,
  
  // 扫描的最大目录深度（默认：2，范围：1-20）
  "fold-search.maxDepth": 2,
  
  // 在搜索结果中包含文件（默认：false）
  "fold-search.includeFiles": false,
  
  // 缓存过期时间（分钟）（默认：10）
  "fold-search.cacheExpiryMinutes": 10,
  
  // 要排除的目录名称（默认：["node_modules", ".git", "dist", "build", "__pycache__"]）
  "fold-search.excludePatterns": [
    "node_modules",
    ".git",
    "dist",
    "build",
    "__pycache__"
  ],
  
  // 要索引的最大项目数（默认：5000）
  "fold-search.maxResults": 5000
}
```

### 配置说明

#### `followSymlinks`（跟踪符号链接）
- **启用（true）**：扫描器将跟踪符号链接并索引其目标目录。符号链接文件夹将标记为 🔗
- **禁用（false）**：符号链接将被忽略，其内容不会被索引
- **建议**：如果有符号链接目录（如 `cases -> /path/to/cases/`），请保持启用

#### `maxDepth`（最大深度）
- **示例**：
  - `1`：仅扫描工作区根文件夹
  - `2`：扫描根 + 1 层（例如：workspace/cases/case-folders）
  - `3`：扫描根 + 2 层（包括案件文件夹中的子文件夹）
  - `10`：深度扫描（可能包括许多嵌套文件夹）

- **对于符号链接目录**：如果有 `workspace/cases -> /path/to/cases/`，深度从工作区根开始计算：
  - 深度 0：workspace/
  - 深度 1：workspace/cases/（符号链接）
  - 深度 2：workspace/cases/CASE001/（符号链接内的第一层）
  - 深度 3：workspace/cases/CASE001/subfolder/（第二层）

- **建议**：使用 `2` 仅索引符号链接目录内的第一层文件夹，避免不必要的子文件夹

#### `includeFiles`（包含文件）
- **启用（true）**：文件和文件夹都将出现在搜索结果中
- **禁用（false）**：仅文件夹出现在搜索结果中
- **建议**：禁用（false）以获得更快的性能和更清晰的结果（当只需要搜索文件夹时）

#### `cacheExpiryMinutes`（缓存过期时间）
扫描器缓存结果以避免每次搜索时重新扫描。此时间后，缓存过期并触发新扫描。
- **示例**：
  - `5`：5 分钟后过期（频繁更新）
  - `10`：默认 - 良好平衡
  - `30`：30 分钟后过期（用于稳定目录）
  - `60`：1 小时后过期（用于很少更改的目录）

#### `excludePatterns`（排除模式）
匹配这些名称的文件夹将在扫描期间被跳过。隐藏文件/文件夹（以 `.` 开头）会自动排除。

#### `maxResults`（最大结果数）
扫描器在索引此数量的项目后将停止，以防止性能问题。
- **示例**：
  - `1000`：用于小型项目
  - `5000`：默认 - 适合大多数项目（1000-2000 个文件夹）
  - `10000`：用于大型项目
  - `20000`：用于非常大的项目

## 为什么选择这个扩展？

### 符号链接问题

许多文件夹搜索扩展无法正确处理符号链接。它们要么：
- 根本不跟踪符号链接（缺少内容）
- 跟踪符号链接但在循环引用时崩溃
- 跟踪符号链接但性能不佳

### 我们的解决方案

本扩展：
- ✅ 使用 `fs.stat()` 跟踪符号链接（而不是 `fs.lstat()`）
- ✅ 使用真实路径解析检测循环引用
- ✅ 优雅地处理损坏的符号链接
- ✅ 用 🔗 标记符号链接文件夹以便识别
- ✅ 通过缓存保持出色的性能

## 使用场景

非常适合具有以下特点的项目：
- 指向共享目录的符号链接
- 具有链接包的 Monorepo 结构
- 具有挂载卷的开发环境
- 引用外部资源的项目

## 示例场景

如果你有这样的项目结构：

```
my-project/
├── src/
├── cases -> /Users/admin/Documents/SharedFiles/Cases/
└── node_modules/
```

其中 `cases` 是指向包含 1700+ 个案件文件夹的目录的符号链接，本扩展将：
1. 跟踪符号链接
2. 索引所有案件文件夹
3. 让你即时搜索它们（例如，搜索 "C2CAR2021" 以查找匹配的案件）
4. 缓存结果以实现快速的后续搜索

## 性能

- **初始扫描**：1700+ 个文件夹仅需 6ms
- **缓存搜索**：< 100ms 响应时间
- **内存使用**：大型工作区 < 100MB

## 要求

- VS Code 1.75.0 或更高版本
- Node.js 文件系统访问

## 已知限制

- 隐藏文件和目录（以 `.` 开头）会自动排除
- 排除列表中的目录会被跳过
- 最大深度限制为 20 层以防止性能问题

## 故障排除

### 符号链接未被跟踪

检查设置中的 `fold-search.followSymlinks` 是否设置为 `true`。

### 缺少文件夹

1. 检查文件夹名称是否在 `fold-search.excludePatterns` 中
2. 验证文件夹深度是否超过 `fold-search.maxDepth`
3. 尝试刷新缓存

### 性能问题

1. 减少 `fold-search.maxDepth` 以限制扫描深度
2. 向 `fold-search.excludePatterns` 添加更多模式
3. 如果工作区非常大，减少 `fold-search.maxResults`

## 贡献

欢迎提出问题和拉取请求！请在 GitHub 仓库上报告任何错误或功能请求。

## 许可证

MIT

## 版本说明

### 1.0.1

优化版本：
- **性能提升**：1700+ 个文件夹的扫描时间从 326ms 减少到 6ms
- **深度控制优化**：仅索引指定深度级别的文件夹
- **增强配置**：所有设置现在都有详细的 markdown 描述
- **默认优化**：针对典型用例的更好默认值（maxDepth: 2, maxResults: 5000）

### 1.0.0

重大改进：
- 优化深度控制逻辑
- 更好地处理大型目录结构
- 改进文档

### 0.0.2

- 将默认 maxResults 增加到 20000
- 更好地处理嵌套文件夹结构

### 0.0.1

初始版本：
- 完全支持符号链接
- 智能缓存
- 智能排序
- 可配置排除项
- 多文件夹工作区支持
